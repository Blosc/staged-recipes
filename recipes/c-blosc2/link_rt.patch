diff --git a/blosc/CMakeLists.txt b/blosc/CMakeLists.txt
index fdbcb6c..030558a 100644
--- a/blosc/CMakeLists.txt
+++ b/blosc/CMakeLists.txt
@@ -144,6 +144,10 @@ if (HAVE_IPP)
     set(LIBS ${LIBS} "${IPP_LIBRARIES}")
 endif (HAVE_IPP)
 
+if (UNIX AND NOT APPLE)
+    set(LIBS ${LIBS} "rt")
+endif (UNIX AND NOT APPLE)
+
 # targets
 if (BUILD_SHARED)
     add_library(blosc2_shared SHARED ${SOURCES})
diff --git a/blosc/context.h b/blosc/context.h
index 3a72697..921d484 100644
--- a/blosc/context.h
+++ b/blosc/context.h
@@ -17,8 +17,8 @@
 #endif
 
 /* Have problems using posix barriers when symbol value is 200112L */
-/* This requires more investigation, but will work for the moment */
-#if defined(_POSIX_BARRIERS) && (_POSIX_BARRIERS >= 200112L)
+/* Requires more investigation, but this will work for the moment */
+#if defined(_POSIX_BARRIERS) && ( (_POSIX_BARRIERS - 20012L) >= 0 && _POSIX_BARRIERS != 200112L)
 #define BLOSC_POSIX_BARRIERS
 #endif
 
diff --git a/blosc/shuffle.c b/blosc/shuffle.c
index beecbd1..d9765c3 100644
--- a/blosc/shuffle.c
+++ b/blosc/shuffle.c
@@ -421,7 +421,7 @@ bitshuffle(const int32_t bytesoftype, const int32_t blocksize,
                                              size, bytesoftype, (void *) _tmp);
   if (ret < 0) {
     // Some error in bitshuffle (should not happen)
-    printf(stderr, "the impossible happened: the bitshuffle filter failed!");
+    fprintf(stderr, "the impossible happened: the bitshuffle filter failed!");
     return ret;
   }
 
@@ -451,7 +451,7 @@ int32_t bitunshuffle(const int32_t bytesoftype, const int32_t blocksize,
                                                    bytesoftype, (void *) _tmp);
       if (ret < 0) {
         // Some error in bitshuffle (should not happen)
-        printf(stderr, "the impossible happened: the bitunshuffle filter failed!");
+        fprintf(stderr, "the impossible happened: the bitunshuffle filter failed!");
         return ret;
       }
       /* Copy the leftovers (we do so starting from c-blosc 1.18 on) */
@@ -468,7 +468,7 @@ int32_t bitunshuffle(const int32_t bytesoftype, const int32_t blocksize,
     int ret = (host_implementation.bitunshuffle)((void *) _src, (void *) _dest,
                                                  size, bytesoftype, (void *) _tmp);
     if (ret < 0) {
-      printf(stderr, "the impossible happened: the bitunshuffle filter failed!");
+      fprintf(stderr, "the impossible happened: the bitunshuffle filter failed!");
       return ret;
     }
 
